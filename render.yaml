services:
  - type: web
    name: nodejs-cheerio-ts
    runtime: docker
    dockerfilePath: ./Dockerfile
    region: singapore # Options: oregon, ohio, frankfurt, singapore
    plan: standard    # Puppeteer needs RAM; standard = 2GB ($25/mo)
                      # Use "starter" ($7/mo, 512MB) only if scraping is light
    healthCheckPath: /
    envVars:
      - key: NODE_ENV
        value: production
      - key: PORT
        value: 3000
      - key: CORS_ORIGIN
        value: "*" # Replace with your actual frontend URL e.g. https://yourapp.com
      - key: REDIS_ENABLED
        value: "true"
      - key: REDIS_HOST
        fromService:
          type: redis
          name: nodejs-cheerio-ts-redis
          property: host
      - key: REDIS_PORT
        fromService:
          type: redis
          name: nodejs-cheerio-ts-redis
          property: port
      - key: PUPPETEER_SKIP_CHROMIUM_DOWNLOAD
        value: "true"
      - key: PUPPETEER_EXECUTABLE_PATH
        value: /usr/bin/google-chrome-stable

  - type: redis
    name: nodejs-cheerio-ts-redis
    region: singapore # Must match web service region above
    plan: free        # free = 25MB RAM, no persistence; upgrade if caching is heavy
    maxmemoryPolicy: allkeys-lru
    ipAllowList: []   # Empty = only allow internal Render services (recommended)
